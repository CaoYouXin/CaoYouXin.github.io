var S={init:function(){var t=window.location.href,e=t.indexOf("?a=");S.Drawing.init(".canvas"),document.body.classList.add("body--ready"),e!==-1?S.UI.simulate(decodeURI(t).substring(e+3)):S.UI.simulate("Shape|Shifter|Type|to start|#rectangle|#countdown 3||"),S.Drawing.loop(function(){S.Shape.render()})}};S.Drawing=function(){var t,e,i,n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};return{init:function(i){t=document.querySelector(i),e=t.getContext("2d"),this.adjustCanvas(),window.addEventListener("resize",function(){S.Drawing.adjustCanvas()})},loop:function(t){i=i?i:t,this.clearFrame(),i(),n.call(window,this.loop.bind(this))},adjustCanvas:function(){t.width=window.innerWidth,t.height=window.innerHeight},clearFrame:function(){e.clearRect(0,0,t.width,t.height)},getArea:function(){return{w:t.width,h:t.height}},drawCircle:function(t,i){e.fillStyle=i.render(),e.beginPath(),e.arc(t.x,t.y,t.z,0,2*Math.PI,!0),e.closePath(),e.fill()}}}(),S.UI=function(){function t(t){var e=t.getHours(),i=t.getMinutes(),n=t.getSeconds();return i=i<10?"0"+i:i,n=n<10?"0"+n:n,e+":"+i+":"+n}function e(t){return t&&t.split(" ")[1]}function i(t){return t=t&&t.split(" ")[0],t&&t[0]===M&&t.substring(1)}function n(t,e,i,n){clearInterval(c),l=n?i:1,t(l),(!i||!n&&l<i||n&&l>0)&&(c=setInterval(function(){l=n?l-1:l+1,t(l),(!n&&i&&l===i||n&&0===l)&&clearInterval(c)},e))}function a(t){clearInterval(c),x=[],d=null,t&&S.Shape.switchShape(S.ShapeBuilder.letter(""))}function r(a){var o,a,h;m.classList.remove("overlay--visible"),x="object"==typeof a?a:x.concat(a.split("|")),u.value="",s(),n(function(s){switch(h=x.shift(),o=i(h),a=e(h),o){case"countdown":a=parseInt(a)||10,a=a>0?a:10,n(function(t){0===t?0===x.length?S.Shape.switchShape(S.ShapeBuilder.letter("")):r(x):S.Shape.switchShape(S.ShapeBuilder.letter(t),!0)},1e3,a,!0);break;case"rectangle":a=a&&a.split("x"),a=a&&2===a.length?a:[y,y/2],S.Shape.switchShape(S.ShapeBuilder.rectangle(Math.min(y,parseInt(a[0])),Math.min(y,parseInt(a[1]))));break;case"circle":a=parseInt(a)||y,a=Math.min(a,y),S.Shape.switchShape(S.ShapeBuilder.circle(a));break;case"time":var c=t(new Date);x.length>0?S.Shape.switchShape(S.ShapeBuilder.letter(c)):n(function(){c=t(new Date),c!==d&&(d=c,S.Shape.switchShape(S.ShapeBuilder.letter(d),!0))},1e3);break;default:S.Shape.switchShape(S.ShapeBuilder.letter(h[0]===M?"What?":h))}},2e3,x.length)}function s(t){u.value.length>18?f.classList.add("ui--wide"):f.classList.remove("ui--wide"),b&&u.value.length>0?f.classList.add("ui--enter"):f.classList.remove("ui--enter")}function o(){document.body.addEventListener("keydown",function(t){u.focus(),13===t.keyCode&&(b=!1,a(),r(u.value))}),u.addEventListener("input",s),u.addEventListener("change",s),u.addEventListener("focus",s),w.addEventListener("click",function(t){m.classList.toggle("overlay--visible"),m.classList.contains("overlay--visible")&&a(!0)}),p.addEventListener("click",function(t){var e,i,n,s;e=t.target.classList.contains("commands-item")?t.target:t.target.parentNode.classList.contains("commands-item")?t.target.parentNode:t.target.parentNode.parentNode,i=e&&e.querySelector(".commands-item-info"),n=e&&i.getAttribute("data-demo"),s=e&&i.getAttribute("data-url"),i&&(m.classList.remove("overlay--visible"),n&&(u.value=n,g?(a(),r(u.value)):u.focus()))}),v.addEventListener("click",function(t){m.classList.remove("overlay--visible")})}function h(){o(),u.focus(),g&&document.body.classList.add("touch")}var c,l,d,u=document.querySelector(".ui-input"),f=document.querySelector(".ui"),w=document.querySelector(".help"),p=document.querySelector(".commands"),m=document.querySelector(".overlay"),v=document.querySelector(".canvas"),g=!1,y=30,b=!0,x=[],M="#";return h(),{simulate:function(t){r(t)}}}(),S.UI.Tabs=function(){function t(t){a[t].classList.add("tabs-label--active"),r[t].classList.add("tabs-panel--active")}function e(){n.addEventListener("click",function(e){var i,n=e.target;if(n.classList.contains("tabs-label")){for(var s=0;s<a.length;s++)a[s].classList.remove("tabs-label--active"),r[s].classList.remove("tabs-panel--active"),n===a[s]&&(i=s);t(i)}})}function i(){t(0),e()}var n=(document.querySelector(".tabs"),document.querySelector(".tabs-labels")),a=document.querySelectorAll(".tabs-label"),r=document.querySelectorAll(".tabs-panel");i()}(),S.Point=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.a=t.a,this.h=t.h},S.Color=function(t,e,i,n){this.r=t,this.g=e,this.b=i,this.a=n},S.Color.prototype={render:function(){return"rgba("+this.r+","+ +this.g+","+this.b+","+this.a+")"}},S.Dot=function(t,e){this.p=new S.Point({x:t,y:e,z:5,a:1,h:0}),this.e=.07,this.s=!0,this.c=new S.Color(255,255,255,this.p.a),this.t=this.clone(),this.q=[]},S.Dot.prototype={clone:function(){return new S.Point({x:this.x,y:this.y,z:this.z,a:this.a,h:this.h})},_draw:function(){this.c.a=this.p.a,S.Drawing.drawCircle(this.p,this.c)},_moveTowards:function(t){var e=this.distanceTo(t,!0),i=e[0],n=e[1],a=e[2],r=this.e*a;if(this.p.h===-1)return this.p.x=t.x,this.p.y=t.y,!0;if(a>1)this.p.x-=i/a*r,this.p.y-=n/a*r;else{if(!(this.p.h>0))return!0;this.p.h--}return!1},_update:function(){if(this._moveTowards(this.t)){var t=this.q.shift();t?(this.t.x=t.x||this.p.x,this.t.y=t.y||this.p.y,this.t.z=t.z||this.p.z,this.t.a=t.a||this.p.a,this.p.h=t.h||0):this.s?(this.p.x-=Math.sin(3.142*Math.random()),this.p.y-=Math.sin(3.142*Math.random())):this.move(new S.Point({x:this.p.x+50*Math.random()-25,y:this.p.y+50*Math.random()-25}))}var e=this.p.a-this.t.a;this.p.a=Math.max(.1,this.p.a-.05*e),e=this.p.z-this.t.z,this.p.z=Math.max(1,this.p.z-.05*e)},distanceTo:function(t,e){var i=this.p.x-t.x,n=this.p.y-t.y,a=Math.sqrt(i*i+n*n);return e?[i,n,a]:a},move:function(t,e){(!e||e&&this.distanceTo(t)>1)&&this.q.push(t)},render:function(){this._update(),this._draw()}},S.ShapeBuilder=function(){function t(){s.width=Math.floor(window.innerWidth/r)*r,s.height=Math.floor(window.innerHeight/r)*r,o.fillStyle="red",o.textBaseline="middle",o.textAlign="center"}function e(){for(var t=o.getImageData(0,0,s.width,s.height).data,e=[],i=0,n=0,a=s.width,h=s.height,c=0,l=0,d=0;d<t.length;d+=4*r)t[d+3]>0&&(e.push(new S.Point({x:i,y:n})),c=i>c?i:c,l=n>l?n:l,a=i<a?i:a,h=n<h?n:h),i+=r,i>=s.width&&(i=0,n+=r,d+=4*r*s.width);return{dots:e,w:c+a,h:l+h}}function i(t){o.font="bold "+t+"px "+c}function n(t){return!isNaN(parseFloat(t))&&isFinite(t)}function a(){t(),window.addEventListener("resize",t)}var r=13,s=document.createElement("canvas"),o=s.getContext("2d"),h=500,c="Avenir, Helvetica Neue, Helvetica, Arial, sans-serif";return a(),{imageFile:function(t,i){var n=new Image,a=S.Drawing.getArea();n.onload=function(){o.clearRect(0,0,s.width,s.height),o.drawImage(this,0,0,.6*a.h,.6*a.h),i(e())},n.onerror=function(){i(S.ShapeBuilder.letter("What?"))},n.src=t},circle:function(t){var i=Math.max(0,t)/2;return o.clearRect(0,0,s.width,s.height),o.beginPath(),o.arc(i*r,i*r,i*r,0,2*Math.PI,!1),o.fill(),o.closePath(),e()},letter:function(t){var a=0;return i(h),a=Math.min(h,s.width/o.measureText(t).width*.8*h,s.height/h*(n(t)?1:.45)*h),i(a),o.clearRect(0,0,s.width,s.height),o.fillText(t,s.width/2,s.height/2),e()},rectangle:function(t,e){for(var i=[],n=r*t,a=r*e,s=0;s<a;s+=r)for(var o=0;o<n;o+=r)i.push(new S.Point({x:o,y:s}));return{dots:i,w:n,h:a}}}}(),S.Shape=function(){function t(){var t=S.Drawing.getArea();a=t.w/2-i/2,r=t.h/2-n/2}var e=[],i=0,n=0,a=0,r=0;return{shuffleIdle:function(){for(var t=S.Drawing.getArea(),i=0;i<e.length;i++)e[i].s||e[i].move({x:Math.random()*t.w,y:Math.random()*t.h})},switchShape:function(s,o){var h,c=S.Drawing.getArea();if(i=s.w,n=s.h,t(),s.dots.length>e.length){h=s.dots.length-e.length;for(var l=1;l<=h;l++)e.push(new S.Dot(c.w/2,c.h/2))}for(var l=0,d=0;s.dots.length>0;)d=Math.floor(Math.random()*s.dots.length),e[l].e=o?.25:e[l].s?.14:.11,e[l].s?e[l].move(new S.Point({z:20*Math.random()+10,a:Math.random(),h:18})):e[l].move(new S.Point({z:5*Math.random()+5,h:o?18:30})),e[l].s=!0,e[l].move(new S.Point({x:s.dots[d].x+a,y:s.dots[d].y+r,a:1,z:5,h:0})),s.dots=s.dots.slice(0,d).concat(s.dots.slice(d+1)),l++;for(var d=l;d<e.length;d++)e[d].s&&(e[d].move(new S.Point({z:20*Math.random()+10,a:Math.random(),h:20})),e[d].s=!1,e[d].e=.04,e[d].move(new S.Point({x:Math.random()*c.w,y:Math.random()*c.h,a:.3,z:4*Math.random(),h:0})))},render:function(){for(var t=0;t<e.length;t++)e[t].render()}}}(),S.init();