!function(e,n,t,a){e.script(document,n+"build/js/back_to_index.js");var o=function(e){var n=document.querySelector(e),t=new THREE.PerspectiveCamera(45,n.clientWidth/n.clientHeight,1,2e3),a=new THREE.Scene;return a.add(new THREE.AmbientLight(16777215)),{Canvas:n,Camera:t,Scene:a,Action:function(){var e=o.Renderer=new THREE.WebGLRenderer({canvas:n});e.setPixelRatio(window.devicePixelRatio),e.setSize(n.clientWidth,n.clientHeight);var a=o.Stats=new Stats;document.body.appendChild(a.dom),window.addEventListener("resize",function(){t.aspect=n.clientWidth/n.clientHeight,t.updateProjectionMatrix(),e.setSize(n.clientWidth,n.clientHeight)},!1)}}}("#canvas");return o.Animator=function(){function e(){requestAnimationFrame(e);var n=a.getDelta();t(n),THREE.AnimationHandler.update(n),o.Renderer.render(o.Scene,o.Camera),o.Stats.update()}function n(e,n){return e-i>r&&(s++,s===c.length&&(s=0),i=e,r=n[s]),c[s](e)}var t,a=new THREE.Clock,i=0,r=0,s=-1,c=[function(e){var n=1e-5*e;o.Camera.position.x=36*Math.cos(n),o.Camera.position.y=0,o.Camera.position.z=36*Math.sin(n)},function(e){var n=5e-5*e;o.Camera.position.x=50*Math.cos(n),o.Camera.position.y=10*Math.cos(3*n),o.Camera.position.z=50*Math.sin(n)},function(e){var n=1e-5*e;o.Camera.position.x=5*Math.cos(n),o.Camera.position.y=5*Math.cos(3*n),o.Camera.position.z=5*Math.sin(n)},function(e){var n=1e-4*e;o.Camera.position.x=180*Math.cos(n),o.Camera.position.y=50*Math.abs(Math.cos(3*n))+15,o.Camera.position.z=180*Math.sin(n)}];return{animate:function(n){t=n||function(){o.Camera.position.x=0,o.Camera.position.y=10,o.Camera.position.z=50,o.Camera.lookAt(o.Scene.position)},e()},action1:function(){t=function(){n(Date.now(),[200,200,200,1e4]),o.Camera.lookAt(o.Scene.position)}},action1plus:function(){var e=function(e){for(var n=0;n<o.Scene.blackHoleRings.length;n++)o.Scene.blackHoleRings[n].rotateY(Math.PI*e*(1.8-.1*n))};if("function"==typeof t){var n=t;t=function(t){n(t),e(t)}}else t=e}}}(),o.ProgressBar=function(e){var n,t=document.querySelector(e),a=0;return{init:function(e){n=100/e},upTogo:function(){a+=n,t.innerHTML=a.toFixed(2)+"% completed",99.9<=a&&(t.style.visibility="hidden",o.Action(),o.Animator.animate(),o.Animator.action1(),o.Animator.action1plus())}}}("#h5-msg > span"),o.TextureManager=function(n){var t,a=[],o=[],i=new THREE.TextureLoader,r="http://image.caols.tech/vanished_love/love.jpg",s="http://image.caols.tech/vanished_love/stars_texture2942.jpg";return{init:function(c){t=c.length;var d=Math.random()*t|0;c.splice(d,0,r),c.push(s),c.every(function(t){return o.push(new e(function(e,o){i.load(t,function(o){o.anisotropy=1,o.wrapS=o.wrapT=THREE.RepeatWrapping,o.repeat.set(1,1),o.mapping=THREE.UVMapping,a.push({key:t,texture:o}),n.upTogo(),e()})})),!0})},ringLen:function(){return t},every:function(n){e.all(o).then(function(){a.every(n)})},isHeartTexture:function(e){return r===e.key},isGalaxyTexture:function(e){return s===e.key},loader:i}}(o.ProgressBar),o.SceneManager=function(e,n){var t,a,i,r=0,s=0,c=10,d=9,u=8,h=0,E=2*Math.PI,l=E/d,p=0,M=Math.PI,m=M/u;return{init:function(){t=n.ringLen(),a=2*Math.PI/t,i=1.9/Math.tan(a/2),n.every(function(t){return n.isHeartTexture(t)?o.SceneManager.addPole(t):n.isGalaxyTexture(t)?o.SceneManager.addGalaxy(t):(o.SceneManager.addRing(t),o.SceneManager.addBall(t)),e.upTogo(),!0}),this.addParticles()},addRing:function(e){var n=new THREE.Mesh(new THREE.PlaneGeometry(3.8,2.4),new THREE.MeshPhongMaterial({map:e.texture})),t=new THREE.Mesh(new THREE.PlaneGeometry(3.8,2.4),new THREE.MeshPhongMaterial({map:e.texture}));n.rotation.set(0,r*a,0),t.rotation.set(0,r*a+Math.PI,0),n.updateMatrix(),t.updateMatrix(),n.position.z=Math.cos(r*a)*i,n.position.x=Math.sin(r*a)*i,t.position.z=Math.cos(r*a)*i,t.position.x=Math.sin(r*a)*i,n.updateMatrix(),t.updateMatrix(),o.Scene.add(n),o.Scene.add(t),r++},addBall:function(e){var n=(s/d|0)+1,t=s-n*d,a=new THREE.Mesh(new THREE.SphereGeometry(c,d,u,h+t*l,l,p+n*m,m),new THREE.MeshPhongMaterial({map:e.texture}));o.Scene.add(a),s++},addPole:function(e){for(var n,t=0;t<u;t+=u-1)for(var a=0;a<d;a++)n=new THREE.Mesh(new THREE.SphereGeometry(c,d,u,h+a*l,l,p+t*m,m),new THREE.MeshPhongMaterial({map:e.texture})),o.Scene.add(n)},addGalaxy:function(e){var n=new THREE.Mesh(new THREE.SphereGeometry(6*c,25*d,25*u,h,(-E),p,(-M)),new THREE.MeshPhongMaterial({map:e.texture,color:16777215}));o.Scene.add(n),n=new THREE.Mesh(new THREE.SphereGeometry(6*c,25*d,25*u,h,E,p,M),new THREE.MeshPhongMaterial({map:e.texture,color:2236962})),o.Scene.add(n),n=new THREE.Mesh(new THREE.SphereGeometry(20*c,50*d,50*u,h,(-E),p,(-M)),new THREE.MeshPhongMaterial({map:e.texture,color:16777215})),o.Scene.add(n),n=new THREE.Mesh(new THREE.SphereGeometry(c,5*d,5*u,h,(-E),p,(-M)),new THREE.MeshPhongMaterial({map:e.texture,color:16777215})),o.Scene.add(n)},addParticles:function(){var e=2e4;o.Scene.blackHoleRings=[];for(var n=1;n<10;n++){for(var t=new THREE.Geometry,a=0;a<e*n;a++){var i=2*Math.random()*Math.PI,r=Math.random()*n*(n+2)+6*c,s=r*Math.sin(i),d=Math.random()-.5,u=r*Math.cos(i),h=new THREE.Vector3(s,d,u);t.vertices.push(h)}var E=new THREE.PointsMaterial({color:new THREE.Color("rgb("+(255-n)+", "+(255-10*n)+", "+(255-20*n)+")"),size:.6,blending:THREE.AdditiveBlending,transparent:!0}),l=new THREE.Points(t,E);o.Scene.add(l),o.Scene.blackHoleRings.push(l)}}}}(o.ProgressBar,o.TextureManager),Detector.webgl||Detector.addGetWebGLMessage(),window.GO_TO_HELL?(window.GO_TO_HELL=!1,window.GO_TO_HELL):void e.ajax(n+"build/json/vanished.love.textures.json").then(function(e){var n=JSON.parse(e);o.ProgressBar.init(2*(n.length+2)),o.TextureManager.init(n),o.SceneManager.init()})}(window.top.ES6Promise.Promise,window.top.Router.rootHref,window.top.Router,window.top.PageSlider);